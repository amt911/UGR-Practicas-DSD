/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "calculadora.h"
#include <time.h>

void suma_calculadora_1(char *host, double a, double b){
	CLIENT *clnt;
	double *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = suma_1(a, b, clnt);
	if (res == (double *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
		printf("El resultado es: %lf\n", *res);

		xdr_free((xdrproc_t) xdr_double, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void resta_calculadora_1(char *host, double a, double b){
	CLIENT *clnt;
	double *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = resta_1(a, b, clnt);
	if (res == (double *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %lf\n", *res);

		xdr_free((xdrproc_t) xdr_double, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void mult_calculadora_1(char *host, double a, double b){
	CLIENT *clnt;
	double *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = mult_1(a, b, clnt);
	if (res == (double *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
		printf("El resultado es: %lf\n", *res);
		xdr_free((xdrproc_t) xdr_double, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}


void division_calculadora_1(char *host, double a, double b){
	CLIENT *clnt;
	double *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = division_1(a, b, clnt);
	if (res == (double *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %lf\n", *res);

		xdr_free((xdrproc_t) xdr_double, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}


void modulo_calculadora_1(char *host, int a, int b){
	CLIENT *clnt;
	int *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = modulo_1(a, b, clnt);
	if (res == (int *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %d\n", *res);

		xdr_free((xdrproc_t) xdr_int, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void raizcuadrada_calculadora_1(char *host, double a){
	CLIENT *clnt;
	double *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = raizcuadrada_1(a, clnt);
	if (res == (double *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %lf\n", *res);

		xdr_free((xdrproc_t) xdr_double, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void esprimo_calculadora_1(char *host, int a){
	CLIENT *clnt;
	int *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = esprimo_1(a, clnt);
	if (res == (int *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %d\n", *res);

		xdr_free((xdrproc_t) xdr_int, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void potencia_calculadora_1(char *host, int a, int b){
	CLIENT *clnt;
	int *res;
#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = potencia_1(a, b, clnt);
	if (res == (int *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
			printf("El resultado es: %d\n", *res);

		xdr_free((xdrproc_t) xdr_int, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void factorial_calculadora_1(char *host, int a){
	CLIENT *clnt;
	int *res;
#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */


	res = factorial_1(a, clnt);
	if (res == (int *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
		printf("El resultado es: %d\n", *res);

		xdr_free((xdrproc_t) xdr_int, res);
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}

void
sumamatricial_calculadora_1(char *host, matrix m1, matrix m2)
{
	CLIENT *clnt;
	matrix *res;

#ifndef	DEBUG
	clnt = clnt_create (host, CALCULADORA, CALCULADORAVER, "udp");
	if (clnt == NULL) {
		clnt_pcreateerror (host);
		exit (1);
	}
#endif	/* DEBUG */

	res = sumamatricial_1(m1, m2, clnt);
	if (res == (matrix *) NULL) {
		clnt_perror (clnt, "call failed");
	}
	else{
		for(int i=0; i<res->fil;i++){
			for(int j=0; j<res->col; j++)
				printf("%lf ", res->m.m_val[i*res->col+j]);

			printf("\n");
		}

		xdr_free((xdrproc_t) xdr_double, res->m.m_val);
		xdr_free((xdrproc_t) xdr_matrix, res);
		//res=NULL;
	}
#ifndef	DEBUG
	clnt_destroy (clnt);
#endif	 /* DEBUG */
}


int
main (int argc, char *argv[])
{
	char *host;

	if (argc < 2) {
		printf ("usage: %s server_host\n", argv[0]);
		exit (1);
	}
	host = argv[1];

	if(argc==2){		//Modo interactivo

	}
	else{	//Modo consola
		char operacion=argv[3][0];

		switch(operacion){
			case '+':
				suma_calculadora_1(host, atof(argv[2]), atof(argv[4]));
				break;

			case '-':
				resta_calculadora_1(host, atof(argv[2]), atof(argv[4]));
				break;			

			case 'x':
				mult_calculadora_1(host, atof(argv[2]), atof(argv[4]));
				break;				

			case '/':
				division_calculadora_1(host, atof(argv[2]), atof(argv[4]));
				break;				
		}
	}

/*
	printf("sizeof: %d\n", sizeof(double));

	matrix m1, m2;

	srand(time(NULL));

	m1.fil=m1.col=m2.fil=m2.col=3;

	m1.m.m_len=m2.m.m_len=m1.fil*m1.col*sizeof(double);					//MUY IMPORTANTE PONERLO, DE OTRA NO SABRIA EMPAQUETAR LOS DATOS

	m1.m.m_val=calloc(m1.fil*m1.col, sizeof(double));
	m2.m.m_val=calloc(m2.fil*m2.col, sizeof(double));


	for(int i=0; i<m1.fil; i++){
		for(int j=0; j<m1.col; j++){
			m1.m.m_val[i*m1.col+j]=rand()%20;
			m2.m.m_val[i*m2.col+j]=rand()%21;
		}
	}

	for(int i=0; i<m1.fil; i++){
		for(int j=0; j<m1.col; j++)
			printf("%lf ", m1.m.m_val[i*m1.col+j]);

		printf("\n");
	}


	printf("\n");

	for (int i = 0; i < m2.fil; i++)
	{
		for (int j = 0; j < m2.col; j++)
			printf("%lf ", m2.m.m_val[i * m2.col + j]);

		printf("\n");
	}

	printf("\n");

	calculadora_1 (host, m1, m2);

	free(m1.m.m_val);
	free(m2.m.m_val);
	*/
exit (0);
}
